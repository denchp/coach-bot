<!-- what does do/why does work? (([a])=>console.log(a))` hi coach dench`; work? (glEnd2 3/2/2020 @9:17p) -->
<html>
    <script type="module" src="/js/ws-client.js"></script>
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/puck.css" />
    <link rel="stylesheet" href="/css/messages.css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <body>
        <div id="alert-container">
            <video id="alert-video"></video>
            <div id="thanks">Thanks for the sub!</div>
            <div class="slashed" id="alert-label">
                <div class="alert-label top"></div>
                <div class="alert-label bot"></div>
            </div>
        </div>
        <div id="follow-container">
            <div class="slashed" id="follow-label">
                <div class="follow-label top"></div>
                <div class="follow-label bot"></div>
            </div>
            <img src="./images/puck.png" id="puck" alt="">
            <img src="./images/shattered.png" id="crack">
        </div>
        <div id="message-box">
        </div>
        <canvas id="canvas"></canvas>
        <script>
            class Store {
                constructor(transformer, initializer) {
                    this.data = new Map();
                    this.transformer = transformer;
                    this.initializer = initializer;
                }
                set(name) {
                    if (this.data.has(name)) {
                        this.data.set(name, this.transformer(name, this.data.get(name)));
                    } else {
                        this.data.set(name, this.initializer(name));
                    }
                }
                get(name) {
                    return this.data.get(name);
                }
            }
        </script>
        <script>
            var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition
            var SpeechRecognitionEvent = SpeechRecognitionEvent || webkitSpeechRecognitionEvent
            const wordStore = new Store((name, value) => value + 1, () => 1);
            var recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.maxAlternatives = 1;
            recognition.addEventListener("result", (e) => {
                recognition.stop();
                const result = e.results[0]
                const { transcript } = result[0];
                const processed = transcript.replace(/[^a-z\s]/gi, "").toUpperCase().split(/\s+/).filter(_ => _);
                for (const word of processed) {
                    wordStore.set(word);
                }
                computeTop();
            });
    
    
            recognition.addEventListener("end", (e) => {
                recognition.start();
            })
            recognition.start();
        </script>
        <script>
            let work_id = 0;
            function computeTop() {
                clearTimeout(work_id);
                setTimeout(() => {
                    const items = Array.from(wordStore.data.entries());
                    const sorted = items.sort((a, b) => b[1] - a[1]).slice(0, 10);
                    document.getElementById("output").innerHTML = `<ol>${sorted.map(([name, count]) => {
                        return `<li><span class="name">${name}</span> (<span class="count">${count}</span>)`;
                    }).join("")}</ol>`;
                }, 10);
            }
        </script>
        <h1>Top Words</h1>
        <div id="output"></div>
    </body>
</html>